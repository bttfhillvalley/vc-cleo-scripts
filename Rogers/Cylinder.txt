{$CLEO .s}
{$INCLUDE ../Common/CleoConstants.txt}
const
    STEAM = 22
    KEY_CYLINDER = 67 // "C"
end
int vehicle
float x
float y
float z
float vx
float vy
float vz
float vehicle_speed
int sound = 0
0000:

while true
    wait 0
    if
        Car.Wrecked(vehicle)
    then
        terminate_this_custom_script
    end
    if and
        3F93: is_sound_stopped "jvt/cylinder_open.wav" index vehicle
        Actor.InCar($PLAYER_ACTOR, vehicle)
        is_key_pressed KEY_CYLINDER
    then
        3F86: attach_sound "jvt/cylinder_open.wav" to_car vehicle offset 0.0 8.0 -0.5 loop 0 size 30.0
    end
    if
        3F92: is_sound_playing "jvt/cylinder_open.wav" index vehicle
    then
        gosub @Steam
    end
end


:Steam
3F43: get_car vehicle right_vector vx vy vz
vx *= -0.1
vy *= -0.1
vz *= -0.1
3F42: get_car vehicle forward_vector x y z
x *= -0.1
y *= -0.1
z *= -0.1
vx += x
vy += y
vz += z

cleo_call @CalculateSpeedOffset 4 vehicle -1.4 8.0 -0.5 ret x y z
0437: scatter_particle STEAM 0.5 at x y z vx vy vz
3F43: get_car vehicle right_vector vx vy vz

vx *= 0.1
vy *= 0.1
vz *= 0.1
3F42: get_car vehicle forward_vector x y z
x *= -0.1
y *= -0.1
z *= -0.1
vx += x
vy += y
vz += z
cleo_call @CalculateSpeedOffset 4 vehicle 1.4 8.0 -0.5 ret x y z
0437: scatter_particle STEAM 0.5 at x y z vx vy vz
return

{$INCLUDE Include/SpeedOffset.txt}